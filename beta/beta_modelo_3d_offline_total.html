<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Modelo 3D Offline</title>
  <style>
    body { margin: 0; overflow: hidden; background: #ff0000; }
  </style>
  <script type="importmap">
    {
      "imports": {
        "three": "./js/three.module.js"
      }
    }
  </script>
</head>
<body>

<script type="module">
import * as THREE from 'three';
import { GLTFLoader } from './js/GLTFLoader.js';
import { OrbitControls } from './js/OrbitControls.js';

// Escena
const scene = new THREE.Scene();


// Cámara
const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.01, 100);
camera.position.set(0, 1.6, 3);

// Renderer
const renderer = new THREE.WebGLRenderer({ antialias: true, stencil: false, alpha: true});
renderer.setClearColor(0x000000, 0); // fondo transparente
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.outputColorSpace = THREE.SRGBColorSpace; // importante para PBR
document.body.appendChild(renderer.domElement);

// Luces
const ambient = new THREE.AmbientLight(0xffffff, 2.0); // luz ambiental fuerte
scene.add(ambient);

const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
dirLight.position.set(5, 10, 7);
scene.add(dirLight);

// Controles
const controls = new OrbitControls(camera, renderer.domElement);
controls.target.set(0, 1.4, 0);
controls.update();

// Loader del modelo
const loader = new GLTFLoader();
loader.load('./models/avatar.glb',
  (gltf) => {
    const model = gltf.scene;

    // Ajustar escala si es necesario
    model.scale.set(1,1,1);

    scene.add(model);

    // Centrar cámara
    const box = new THREE.Box3().setFromObject(model);
    const center = box.getCenter(new THREE.Vector3());
    controls.target.copy(center);
    controls.update();

    console.log('Modelo cargado correctamente:', model);
  },
  undefined,
  (error) => console.error('Error cargando el modelo:', error)
);

// Resize
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// Animación
function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();

</script>

</body>
</html>
