<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; margin: 0; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .controls { text-align: center; margin-bottom: 20px; }
        
        button { padding: 10px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; font-size: 1rem; }
        .btn-create { background-color: #28a745; color: white; }
        .btn-filter { background-color: #007bff; color: white; }
        .btn-filter.active { background-color: #0056b3; border: 2px solid #003d80; }
        
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; max-width: 1000px; margin: 0 auto; }
        .gallery-item { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; cursor: pointer; background: white; position: relative; }
        .gallery-img { width: 100%; height: 180px; object-fit: cover; display: block; }
        .gallery-info { padding: 8px; text-align: center; font-size: 0.85rem; color: #333; background: #f8f9fa; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); align-items: center; justify-content: center; flex-direction: column; }
        .modal-content { max-width: 80%; max-height: 70%; border-radius: 5px; }
        .modal-text { color: white; font-size: 1.5rem; margin-top: 15px; font-weight: bold; background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 5px; }
        .close { position: absolute; top: 20px; right: 30px; color: white; font-size: 40px; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    <h2>Panel de Administración</h2>
    <button class="btn-create" onclick="window.location.href='nuevo_pedido.html'">+ Crear Nuevo Pedido</button>
    <button style="background-color: #666; color: white;" onclick="window.location.href='index.html'">Cerrar Sesión</button>
</div>

<div class="controls">
    <h3>Ver Pedidos</h3>
    <button class="btn-filter active" onclick="filtrar('todos', this)">Todos</button>
    <button class="btn-filter" onclick="filtrar('mug', this)">Mugs</button>
    <button class="btn-filter" onclick="filtrar('camisa', this)">Camisas</button>
</div>

<div id="gallery" class="gallery"></div>

<!-- Modal Admin -->
<div id="imageModal" class="modal" onclick="cerrarModal()">
    <span class="close">&times;</span>
    <img class="modal-content" id="imgGrande">
    <div class="modal-text" id="modalInfo"></div>
</div>

<script>
    let todosLosPedidos = [];

    // Cargar pedidos al inicio
    fetch('pedidos.json')
        .then(res => res.json())
        .then(data => {
            todosLosPedidos = data;
            renderGallery(data);
        })
        .catch(err => console.error("Error cargando pedidos:", err));

    function renderGallery(pedidos) {
        const gallery = document.getElementById('gallery');
        gallery.innerHTML = '';

        pedidos.forEach(pedido => {
            if (!pedido.imagen_url) return;

            const item = document.createElement('div');
            item.className = 'gallery-item';
            // Pasamos el objeto pedido completo al click
            item.onclick = () => abrirModal(pedido);

            item.innerHTML = `
                <img src="${pedido.imagen_url}" class="gallery-img" loading="lazy">
                <div class="gallery-info">
                    <strong>${pedido.producto}</strong><br>
                    ${pedido.telefono}
                </div>
            `;
            gallery.appendChild(item);
        });
    }

    function filtrar(categoria, btn) {
        // Actualizar botones activos
        document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        if (categoria === 'todos') {
            renderGallery(todosLosPedidos);
        } else {
            // Filtro insensible a mayúsculas/minúsculas
            const filtrados = todosLosPedidos.filter(p => 
                p.producto.toLowerCase().includes(categoria.toLowerCase())
            );
            renderGallery(filtrados);
        }
    }

    function abrirModal(pedido) {
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('imgGrande');
        const modalInfo = document.getElementById('modalInfo');

        modal.style.display = "flex";
        modalImg.src = pedido.imagen_url;
        // Texto grande abajo
        modalInfo.innerHTML = `
            Cliente: ${pedido.telefono}<br>
            <span style="font-size: 1rem; font-weight: normal;">${pedido.producto} - ${pedido.fecha}</span>
        `;
    }

    function cerrarModal() {
        document.getElementById('imageModal').style.display = "none";
    }
</script>

</body>
</html>